<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รายการสินค้า</title>
    <!-- ใช้ฟอนต์ Kanit สำหรับภาษาไทย -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- นำเข้า Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- นำเข้า Swiper สำหรับการแสดงผลแบบสไลด์ -->
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
    <style>
        /* สไตล์พื้นฐานของหน้าเว็บ */
        body {
            font-family: 'Kanit', sans-serif;
            background: linear-gradient(to bottom right, #e6f0ff, #dbeafe);
            text-align: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            padding-bottom: 60px; /* ระยะห่างด้านล่างสำหรับ footer */
        }
        
        /* แอนิเมชันการโหลด */
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* สไตล์ปุ่มแชร์ */
        .share-button {
            background: linear-gradient(to right, #10B981, #34D399);
            transition: all 0.3s ease;
        }
        .share-button:hover {
            background: linear-gradient(to right, #059669, #22D3EE);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* สไตล์รูปโปรไฟล์ */
        #profilePicture {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #e6f0ff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            object-fit: cover;
            margin: 0 auto 10px;
        }
        
        /* การ์ดสินค้า */
        .product-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 16px;
            padding-bottom: 20px; /* ระยะห่างด้านล่างสำหรับปุ่มแชร์ */
            margin-bottom: 16px;
            text-align: left;
            width: 100%;
            max-width: 90vw;
            display: flex;
            flex-direction: column;
        }
        
        /* ส่วนหัวการ์ดสินค้า */
        .product-card h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1a0dab;
            margin-bottom: 8px;
        }
        
        /* รายละเอียดสินค้า */
        .product-card p {
            font-size: 0.9rem;
            color: #4a4a4a;
            margin-bottom: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }
        
        /* ลิงก์สินค้า */
        .product-card a {
            color: #1a0dab;
            text-decoration: none;
            font-weight: 500;
        }
        .product-card a:hover {
            text-decoration: underline;
        }
        
        /* ส่วนแสดงรูปภาพสินค้า */
        .image-container {
            position: relative;
            width: 100%;
            padding-bottom: 75%; /* อัตราส่วนภาพ 4:3 */
            margin-bottom: 12px;
            background: #f8fafc; /* พื้นหลังสำหรับรูปภาพขนาดเล็ก/โปร่งใส */
            border-radius: 8px;
            border: 1px solid #dbeafe;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        .image-container:hover {
            transform: scale(1.05);
        }
        .product-card img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }
        
        /* ส่วนปุ่มแชร์ */
        .product-card .button-container {
            display: flex;
            justify-content: flex-end;
            margin-top: 16px; /* ระยะห่างด้านบนของปุ่มแชร์ */
        }
        
        /* สไตล์ Swiper สำหรับสไลด์ */
        .swiper-container {
            width: 100%;
            max-width: 95vw;
            margin: 0 auto;
            padding-bottom: 10px; /* ลดระยะห่างด้านล่างเพื่อเลื่อนจุด pagination ขึ้น */
        }
        .swiper-pagination {
            position: relative;
            margin-top: -8px; /* ดึงจุด pagination ขึ้นด้านบน */
        }
        .swiper-slide {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .swiper-slide .product-card {
            width: 85%; /* ปรับขนาดสำหรับการจัดกึ่งกลางและระยะห่างที่ดีขึ้น */
            margin: auto;
        }
        
        /* Footer */
        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to right, #e6f0ff, #dbeafe);
            padding: 12px 0;
            text-align: center;
            box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.1);
            border-top: 1px solid #dbeafe;
            z-index: 1000;
        }
        footer p {
            font-size: 0.9rem;
            color: #1a0dab;
            margin: 0;
            font-weight: 500;
        }
        
        /* สไตล์ SweetAlert2 (หน้าต่างแจ้งเตือน) */
        .swal2-popup {
            font-family: 'Kanit', sans-serif;
            background: linear-gradient(135deg, #ffffff, #f0f7ff);
            border-radius: 16px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            padding: 20px;
            border: 1px solid #dbeafe;
            animation: swalFadeIn 0.4s ease-in-out;
        }
        .swal2-title {
            color: #1a0dab;
            font-weight: 700;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        .swal2-content {
            color: #4a4a4a;
            font-size: 1rem;
            line-height: 1.5;
        }
        .swal2-confirm, .swal2-cancel {
            font-family: 'Kanit', sans-serif;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .swal2-confirm {
            background: linear-gradient(to right, #4285F4, #34D399);
            color: white;
        }
        .swal2-confirm:hover {
            background: linear-gradient(to right, #3267D6, #22D3EE);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .swal2-cancel {
            background: linear-gradient(to right, #f87171, #ef4444);
            color: white;
        }
        .swal2-cancel:hover {
            background: linear-gradient(to right, #dc2626, #f87171);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .swal2-icon.swal2-error {
            border-color: #ef4444;
            color: #ef4444;
        }
        .swal2-icon.swal2-warning {
            border-color: #f59e0b;
            color: #f59e0b;
        }
        .swal2-icon.swal2-success {
            border-color: #10B981;
            color: #10B981;
        }
        @keyframes swalFadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        /* การปรับแต่งสำหรับหน้าจอขนาดเล็ก */
        @media (max-width: 640px) {
            .product-card {
                padding: 12px;
                padding-bottom: 16px; /* ปรับสำหรับหน้าจอขนาดเล็ก */
            }
            .product-card h3 {
                font-size: 1rem;
            }
            .product-card p {
                font-size: 0.85rem;
            }
            .image-container {
                padding-bottom: 75%; /* รักษาอัตราส่วนภาพ 4:3 */
            }
            .button-container {
                margin-top: 12px; /* ปรับสำหรับหน้าจอขนาดเล็ก */
            }
            .swiper-container {
                padding-bottom: 8px; /* ลดระยะห่างด้านล่างสำหรับหน้าจอขนาดเล็ก */
            }
            .swiper-pagination {
                margin-top: -6px; /* ดึงจุด pagination ขึ้นด้านบนสำหรับหน้าจอขนาดเล็ก */
            }
            footer p {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body class="text-gray-800">
    <!-- หน้าต่างโหลดข้อมูล -->
    <div id="preloader" class="fixed inset-0 bg-white flex flex-col items-center justify-center z-[1000]">
        <div class="w-12 h-12 border-4 border-blue-300 border-t-blue-600 rounded-full animate-spin mb-5"></div>
        <p class="text-lg text-blue-600">กำลังโหลด...</p>
    </div>

    <!-- ส่วนเนื้อหาหลัก -->
    <div id="main" class="hidden max-w-md mx-auto">
        <img id="profilePicture" src="https://via.placeholder.com/40" alt="รูปโปรไฟล์">
        <h1 class="text-2xl text-blue-600 font-bold mb-4">รายการสินค้า</h1>
        <div class="swiper-container">
            <div class="swiper-wrapper" id="productsContainer"></div>
            <div class="swiper-pagination"></div>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>Cafe Life</p>
    </footer>

    <!-- นำเข้าไลบรารีที่จำเป็น -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script>
        // ตรวจสอบว่าเป็นอุปกรณ์มือถือหรือไม่
        function isMobileDevice() {
            return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        }

        // โหลด LIFF SDK
        function loadLiffScript(callback) {
            const script = document.createElement('script');
            script.src = 'https://static.line-scdn.net/liff/edge/2/sdk.js';
            script.async = true;
            script.onload = callback;
            script.onerror = () => {
                Swal.fire({
                    icon: 'error',
                    title: 'โหลด LIFF ล้มเหลว',
                    text: 'กรุณาตรวจสอบการเชื่อมต่อ',
                });
            };
            document.head.appendChild(script);
        }

        // เริ่มต้น LIFF และตั้งค่ารูปโปรไฟล์
        async function initializeLiff() {
            if (typeof liff === 'undefined') {
                Swal.fire({
                    icon: 'error',
                    title: 'LIFF SDK ไม่โหลด',
                    text: 'ไม่สามารถโหลด LIFF ได้',
                });
                return false;
            }
            try {
                await liff.init({ liffId: '2008400687-26y34vq3' });
                await liff.ready;

                let profilePicture = 'https://via.placeholder.com/40';
                if (liff.isLoggedIn()) {
                    try {
                        const profile = await liff.getProfile();
                        if (profile.pictureUrl) {
                            profilePicture = profile.pictureUrl;
                        }
                    } catch (error) {
                        console.error('ไม่สามารถดึงข้อมูลโปรไฟล์:', error);
                    }
                }

                document.getElementById('profilePicture').src = profilePicture;

                document.getElementById('preloader').style.display = 'none';
                document.getElementById('main').style.display = 'block';
                return true;
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'LIFF ล้มเหลว',
                    text: error.message,
                });
                return false;
            }
        }

        // ดึงข้อมูลสินค้าจาก Google Apps Script Web App
        async function fetchProducts() {
            const url = 'https://script.google.com/macros/s/AKfycbyc09od-TsyeMZlxgd9MM_aTzuFwjTdljFl7WFwEo7wuBGmYp6f7PGObtGUQ95H7aTTJA/exec';
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`ไม่สามารถดึงข้อมูลจาก GAS Web App: ${response.status}`);
                }
                const data = await response.json();
                if (data.error) {
                    throw new Error(data.error);
                }
                if (!Array.isArray(data) || data.length === 0) {
                    return [];
                }
                return data.map(item => ({
                    title: item.title && typeof item.title === 'string' ? item.title.trim() : 'ไม่มีชื่อ',
                    description: item.description && typeof item.description === 'string' ? item.description.trim() : 'ไม่มีคำอธิบาย',
                    image: item.image && typeof item.image === 'string' && item.image.match(/^https?:\/\//) ? item.image.trim() : 'https://via.placeholder.com/150?text=ไม่มีรูปภาพ',
                    link: item.link && typeof item.link === 'string' && item.link.match(/^https?:\/\//) ? item.link.trim() : '#',
                    price: item.price && !isNaN(parseFloat(item.price)) ? parseFloat(item.price).toFixed(2) : null
                }));
            } catch (error) {
                console.error('เกิดข้อผิดพลาดในการดึงข้อมูลสินค้า:', error);
                throw error;
            }
        }

        // ฟังก์ชันตัดข้อความให้อยู่ในความยาวที่กำหนดโดยรักษาความสมบูรณ์ของประโยค
        function truncateText(text, maxLength) {
            if (!text || text.length <= maxLength) return text;
            
            // หาตำแหน่งที่ใกล้ maxLength โดยไม่ตัดกลางคำหรือประโยค
            let truncated = text.substring(0, maxLength);
            
            // หาจุดสิ้นสุดประโยคที่ใกล้ที่สุด
            const lastSentenceEnd = Math.max(
                truncated.lastIndexOf('. '),
                truncated.lastIndexOf('! '),
                truncated.lastIndexOf('? ')
            );
            
            if (lastSentenceEnd > 0 && (maxLength - lastSentenceEnd) < 30) {
                truncated = truncated.substring(0, lastSentenceEnd + 1);
            } else {
                // หาช่องว่างสุดท้ายถ้าไม่มีจุดสิ้นสุดประโยค
                const lastSpace = truncated.lastIndexOf(' ');
                if (lastSpace > 0) {
                    truncated = truncated.substring(0, lastSpace);
                }
            }
            
            return truncated + (text.length > maxLength ? '...' : '');
        }

        // สร้าง Flex Message สำหรับแชร์สินค้า
        function createFlexMessage(title, description, url, image, liffId, price) {
            // ตรวจสอบและทำความสะอาดข้อมูลนำเข้า
            const safeTitle = title && typeof title === 'string' ? title.trim() : 'ไม่มีชื่อ';
            const safeDescription = description && typeof description === 'string' ? description.trim() : 'ไม่มีคำอธิบาย';
            const safeImage = image && typeof image === 'string' && image.match(/^https?:\/\//) ? image.trim() : 'https://via.placeholder.com/150?text=ไม่มีรูปภาพ';
            const safeUrl = url && typeof url === 'string' && url.match(/^https?:\/\//) ? url.trim() : '#';
            const priceText = price && !isNaN(parseFloat(price)) ? `ราคา: ${parseFloat(price).toFixed(2)} บาท` : 'ราคา: ติดต่อสอบถาม';

            // ตัดคำอธิบายให้เหมาะสมกับ Flex Message
            const maxDescriptionLength = 600; // ความยาวสูงสุดของคำอธิบาย
            const displayDescription = truncateText(safeDescription, maxDescriptionLength);

            const flexMessage = {
                type: "bubble",
                size: "mega",
                hero: {
                    type: "image",
                    url: safeImage,
                    size: "full",
                    aspectRatio: "1:1",
                    aspectMode: "cover",
                    action: {
                        type: "uri",
                        uri: safeUrl
                    }
                },
                body: {
                    type: "box",
                    layout: "vertical",
                    contents: [
                        {
                            type: "text",
                            text: safeTitle,
                            weight: "bold",
                            size: "lg",
                            color: "#000000",
                            wrap: true,
                            margin: "md"
                        },
                        {
                            type: "separator",
                            margin: "sm"
                        },
                        {
                            type: "box",
                            layout: "vertical",
                            contents: [
                                {
                                    type: "text",
                                    text: displayDescription,
                                    size: "sm",
                                    color: "#666666",
                                    wrap: true,
                                    margin: "sm",
                                    flex: 1
                                }
                            ],
                            margin: "sm",
                            paddingAll: "sm",
                            backgroundColor: "#f9f9f9",
                            cornerRadius: "sm"
                        },
                        {
                            type: "text",
                            text: priceText,
                            size: "md",
                            color: "#FF0000",
                            weight: "bold",
                            wrap: true,
                            margin: "md"
                        },
                        {
                            type: "separator",
                            margin: "lg"
                        },
                        {
                            type: "box",
                            layout: "horizontal",
                            contents: [
                                {
                                    type: "button",
                                    style: "primary",
                                    color: "#00C300",
                                    height: "sm",
                                    action: {
                                        type: "uri",
                                        label: "สั่งซื้อสินค้า",
                                        uri: safeUrl
                                    },
                                    flex: 1,
                                    margin: "sm"
                                },
                                {
                                    type: "button",
                                    style: "primary",
                                    color: "#EC4899",
                                    height: "sm",
                                    action: {
                                        type: "uri",
                                        label: "แชร์สินค้าต่อ",
                                        uri: `https://liff.line.me/${liffId}?title=${encodeURIComponent(safeTitle)}&description=${encodeURIComponent(safeDescription)}&url=${encodeURIComponent(safeUrl)}&image=${encodeURIComponent(safeImage)}${price ? `&price=${encodeURIComponent(price)}` : ''}`
                                    },
                                    flex: 1,
                                    margin: "sm"
                                }
                            ],
                            margin: "md"
                        }
                    ],
                    paddingAll: "md",
                    backgroundColor: "#FFFFFF",
                    cornerRadius: "10px",
                    borderWidth: "1px",
                    borderColor: "#E0E0E0"
                },
                footer: {
                    type: "box",
                    layout: "vertical",
                    contents: [
                        {
                            type: "text",
                            text: "Powered by Cafe Life",
                            size: "xxs",
                            color: "#AAAAAA",
                            align: "center",
                            wrap: true
                        }
                    ],
                    paddingAll: "sm",
                    backgroundColor: "#666666"
                }
            };
            return flexMessage;
        }

        // แชร์สินค้าผ่าน LINE
        async function shareProduct(title, description, url, image, price) {
            try {
                if (typeof liff === 'undefined') {
                    throw new Error('LIFF SDK ไม่โหลด');
                }
                await liff.ready;
                if (!liff.isInClient()) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'ต้องใช้ใน LINE',
                        text: 'กรุณาเปิดใน LINE เพื่อแชร์',
                        confirmButtonText: 'เปิดใน LINE',
                        showCancelButton: true,
                        cancelButtonText: 'ยกเลิก'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            window.location.href = 'line://app/2008400687-26y34vq3';
                        }
                    });
                    return;
                }
                if (!liff.isLoggedIn()) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'กรุณาล็อกอิน',
                        text: 'ต้องล็อกอิน LINE เพื่อแชร์',
                        confirmButtonText: 'ล็อกอิน',
                        showCancelButton: true
                    }).then((result) => {
                        if (result.isConfirmed) {
                            liff.login({ redirectUri: window.location.href });
                        }
                    });
                    return;
                }
                const liffId = '2008400687-26y34vq3';
                // ถอดรหัสพารามิเตอร์เพื่อให้แสดงผลถูกต้อง
                const decodedTitle = decodeURIComponent(title || '');
                const decodedDescription = decodeURIComponent(description || '');
                const decodedUrl = decodeURIComponent(url || '');
                const decodedImage = decodeURIComponent(image || '');
                const decodedPrice = price ? decodeURIComponent(price) : null;

                const message = createFlexMessage(decodedTitle, decodedDescription, decodedUrl, decodedImage, liffId, decodedPrice);
                const result = await liff.shareTargetPicker([{
                    type: 'flex',
                    altText: `สินค้า: ${decodedTitle || 'ไม่มีชื่อ'}`,
                    contents: message
                }]);
                if (result) {
                    Swal.fire({
                        icon: 'success',
                        title: 'แชร์สำเร็จ',
                        timer: 1500,
                        showConfirmButton: false
                    });
                  liff.closeWindow();
                } else {
                    liff.closeWindow();
                }
            } catch (error) {
                console.error('เกิดข้อผิดพลาดในการแชร์สินค้า:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'เกิดข้อผิดพลาดในการแชร์',
                    text: error.message || 'ไม่สามารถแชร์สินค้าได้',
                });
            }
        }

        // แสดงสินค้าในหน้าเว็บ
        let allProducts = []; // เก็บข้อมูลสินค้าทั้งหมด
        let swiperInstance = null; // เก็บ instance ของ Swiper
        async function displayProducts() {
            const productsContainer = document.getElementById('productsContainer');
            productsContainer.innerHTML = '<div class="swiper-slide text-gray-600">กำลังโหลดสินค้า...</div>';

            try {
                if (allProducts.length === 0) {
                    allProducts = await fetchProducts();
                }
                let products = allProducts;

                if (products.length === 0) {
                    productsContainer.innerHTML = '<div class="swiper-slide text-gray-600">ไม่มีสินค้าในขณะนี้</div>';
                    Swal.fire({
                        icon: 'warning',
                        title: 'ไม่มีสินค้า',
                        text: 'ไม่มีสินค้าในขณะนี้',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    return;
                }

                let html = '';
                products.forEach(item => {
                    html += `
                        <div class="swiper-slide product-card">
                            <div class="image-container">
                                <img src="${item.image}" alt="${item.title}" onerror="this.src='https://via.placeholder.com/150?text=ไม่มีรูปภาพ'">
                            </div>
                            <h3><a href="${item.link}" target="_blank">${item.title}</a></h3>
                            <p>${truncateText(item.description, 100)}</p>
                            <div class="button-container">
                                <button onclick="shareProduct('${encodeURIComponent(item.title)}', '${encodeURIComponent(item.description)}', '${encodeURIComponent(item.link)}', '${encodeURIComponent(item.image)}', ${item.price ? `'${encodeURIComponent(item.price)}'` : 'null'})" class="p-3 share-button text-white rounded-lg shadow-md">แชร์สินค้า</button>
                            </div>
                        </div>
                    `;
                });
                productsContainer.innerHTML = html;

                // ทำลาย Swiper instance เดิมถ้ามี
                if (swiperInstance) {
                    swiperInstance.destroy(true, true);
                }

                // สร้าง Swiper instance ใหม่
                swiperInstance = new Swiper('.swiper-container', {
                    loop: products.length > 1,
                    centeredSlides: true, // จัดกึ่งกลาง slide
                    pagination: {
                        el: '.swiper-pagination',
                        clickable: true,
                    },
                    navigation: {
                        nextEl: '.swiper-button-next',
                        prevEl: '.swiper-button-prev',
                    },
                    slidesPerView: 1,
                    spaceBetween: 20, // ระยะห่างระหว่างการ์ด
                });
            } catch (error) {
                console.error('เกิดข้อผิดพลาดในการแสดงสินค้า:', error);
                productsContainer.innerHTML = `<div class="swiper-slide text-red-600">เกิดข้อผิดพลาด: ${error.message}</div>`;
                Swal.fire({
                    icon: 'error',
                    title: 'ไม่สามารถดึงสินค้า',
                    text: error.message,
                    confirmButtonText: 'ตกลง'
                });
            }
        }

        // จัดการการเรียก LIFF ผ่าน URL parameters สำหรับแชร์ต่อ
        async function handleLiffCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const title = urlParams.get('title');
            const description = urlParams.get('description');
            const url = urlParams.get('url');
            const image = urlParams.get('image');
            const price = urlParams.get('price');

            // ตรวจสอบพารามิเตอร์
            if (title && description && url && image) {
                await shareProduct(title, description, url, image, price);
            } else {
                console.warn('พารามิเตอร์ URL สำหรับ LIFF callback ไม่ครบถ้วนหรือไม่ถูกต้อง:', { title, description, url, image, price });
            }
        }

        // เริ่มต้นเมื่อหน้าเว็บโหลด
        window.onload = function() {
            if (!isMobileDevice()) {
                document.getElementById('preloader').style.display = 'none';
                Swal.fire({
                    icon: 'error',
                    title: 'ไม่สามารถเปิดบน PC ได้'
                });
                return;
            }

            loadLiffScript(async () => {
                const initialized = await initializeLiff();
                if (initialized) {
                    await displayProducts();
                    await handleLiffCallback();
                }
            });
        };
    </script>
</body>
</html>
